<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" >
    <title>Guardian Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://fonts.googleapis.com/css?family=Mali|Schoolbell|Sue+Ellen+Francisco" rel="stylesheet">
    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <link href="https://fonts.googleapis.com/css?family=Sigmar+One" rel="stylesheet">

    <script src="https://www.gstatic.com/firebasejs/4.6.0/firebase.js"></script>
    <script>
        // Initialize Firebase
        let config = {
            apiKey: "AIzaSyBzJhjPTm8O_pdF3u7JCkFnYjhArX3Fte4",
            authDomain: "scout-game.firebaseapp.com",
            databaseURL: "https://scout-game.firebaseio.com",
            projectId: "scout-game",
            storageBucket: "scout-game.appspot.com",
            messagingSenderId: "277037324529"
        };
        firebase.initializeApp(config);
    </script>
    <script>

        let fb=firebase.database();
        let userId = window.location.hash.substring(1);

        fb.ref('scout-game/'+userId).on('value',function(snapshot) {
                players=snapshot.val().lastRequest.split('-')
                $("#player1").html(players[0]);
               $("#player2").html(players[1]);


        });


        $(function () {
            $( "#dialog-confirm" ).dialog({
                autoOpen:false,
                resizable: false,
                height: "auto",
                width: 300,
                modal: true,
                buttons: [{
                    text: "Approve",
                    "class": "dialog-btn-accept",
                    click: function () {
                      fb.ref('scout-game/'+userId+'/').update({"start":1});
                        $(this).dialog("close");
                    }
                },
                    {
                        text:"Ignore",
                        "class":"dialog-btn-ignore" ,
                        click: function() {
                            $( this ).dialog( "close" );
                        }
                    }],

            });
        })

        fb.ref('scout-game/'+userId).on('value',function(snapshot){
            lastRequest=snapshot.val().lastRequest;
            if(lastRequest){
                $( "#dialog-confirm" ).dialog('open');
            }

        });
        let database=firebase.database();

        function getData(){
            let db=database.ref(/scout-game/ + userId );
            db.on('value',function (snapshot){

                $("#table").html('');
                snapshot.forEach(function (childSnapshot){
                    if(childSnapshot.val().active===1){
                        $('#noActive').hide();
                        $('.foot').show();
                        $("#table").append('<tr><td><a href="GameType.html#'+userId+'#'+childSnapshot.key+'"><img src="page3/emoji-3-feild-empty.png" class="players-img" onclick="goToGameType()"></a></td> <td class="name">' + childSnapshot.val().name + '</td></td></tr>');
                    }else{
                    }
                });
            });
        }
        getData();

       function gotToNewPlayer(){
           window.location.replace("newPlayer.html#"+userId);
        }

        //        alert(user.getUserId());

    </script>

    <style>
        @font-face {
            font-family: "Marker Felt";
            src: url("fonts/DSMarkerFelt.ttf");

        }
        .ui-dialog-title{
            font-family: "Marker Felt";
            font-size: 20px;
            color: rgba(40, 206, 146, 0.76);
            position: relative;
            left:10px;
            top:10px;
        }
        .ui-widget-header{
            background-color: rgba(2, 8, 6, 0.76);
            height:40px;
            border-radius: 10px;
        }
        .dialog-btn-accept{
            width:100px;
            height:40px;
            font-family: "Marker Felt";
            font-size: 20px;
            position: relative;
            left: 10px;
            bottom: 10px;
            background-color: rgb(40, 206, 146);
            color:white;
            border-radius: 5px;
            border-color: rgba(2,8,6,0);
        }
        .dialog-btn-ignore{
            border-color: rgba(2,8,6,0);
            border-radius: 5px;
            width:100px;
            height:40px;
            font-family: "Marker Felt";
            font-size: 20px;
            position: relative;
            left: 15px;
            bottom: 10px;
            background-color: rgba(252,16,81,0.77);
            color:white;
        }
        .ui-dialog-titlebar-close{
            display:none;
        }
        .ui-dialog{
            border-radius: 10px;
            font-family: "Marker Felt";
            background-color: rgba(2, 8, 6, 0.77);
            color: white;




        }
        #dialog-confirm{
            position: relative;
            left:10px;
            font-size: 20px;
        }
        .bg{
            background-image: url("buttons-bg/new-background-2.png");
            background-size: cover;

        }
        .title{

            position: relative;
            top: 50px;
            font-size: 80px;
            margin-top: 50px;
            font-family: "Marker Felt";
            text-align: center;
            color: white;

        }

        .players-img{
            position: relative;
            width:351px;
            height:90px;
            top:70px;
            left:34px;
            margin-top: -50px;

        }
        #noActive{
            font-size: 40px;
            font-family: "Marker Felt";
            position: relative;
            top:50px;
            color: rgba(252, 255, 242, 0.95)
        }
        .name {

            display: flex;
            text-align: left;
            position: relative;
            top: 45px;
            right: 270px;
            color: white;
            font-size: 27px;
            font-family: 'Schoolbell', cursive;
        }


    </style>
</head>
<body class="bg">
<div class="container-fluid" >
    <div  align="center">
        <h1 class="title" align="center">Dashboard</h1>
    </div>
    <div id="dialog-confirm"  title="Game Request" >
        <p id="dialog-text" ><span class="ui-icon ui-icon-alert" style="float:right; margin:12px 12px 20px 0;"></span><span id="player1"></span> and <span id="player2"></span> want to play together.<br> Approve?</p>
    </div>

    <table  align="center">
        <tr><td id="noActive"> No Active Players</td></tr>

        <tbody id="table" >

        </tbody>

    </table>

</div>

</body>
</html>